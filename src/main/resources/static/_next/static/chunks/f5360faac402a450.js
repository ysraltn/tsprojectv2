(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,10204,e=>{"use strict";e.s(["Label",()=>i],10204);var t=e.i(43476),r=e.i(71645),l=e.i(48425),s=r.forwardRef((e,r)=>(0,t.jsx)(l.Primitive.label,{...e,ref:r,onMouseDown:t=>{var r;t.target.closest("button, input, select, textarea")||(null==(r=e.onMouseDown)||r.call(e,t),!t.defaultPrevented&&t.detail>1&&t.preventDefault())}}));s.displayName="Label";var a=e.i(75157);function i(e){let{className:r,...l}=e;return(0,t.jsx)(s,{"data-slot":"label",className:(0,a.cn)("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",r),...l})}},87486,e=>{"use strict";e.s(["Badge",()=>i]);var t=e.i(43476),r=e.i(91918),l=e.i(25913),s=e.i(75157);let a=(0,l.cva)("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function i(e){let{className:l,variant:i,asChild:n=!1,...d}=e,o=n?r.Slot:"span";return(0,t.jsx)(o,{"data-slot":"badge",className:(0,s.cn)(a({variant:i}),l),...d})}},75254,e=>{"use strict";e.s(["default",()=>i],75254);var t=e.i(71645);let r=e=>{let t=e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,r)=>r?r.toUpperCase():t.toLowerCase());return t.charAt(0).toUpperCase()+t.slice(1)},l=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.filter((e,t,r)=>!!e&&""!==e.trim()&&r.indexOf(e)===t).join(" ").trim()};var s={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let a=(0,t.forwardRef)((e,r)=>{let{color:a="currentColor",size:i=24,strokeWidth:n=2,absoluteStrokeWidth:d,className:o="",children:c,iconNode:u,...m}=e;return(0,t.createElement)("svg",{ref:r,...s,width:i,height:i,stroke:a,strokeWidth:d?24*Number(n)/Number(i):n,className:l("lucide",o),...!c&&!(e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0})(m)&&{"aria-hidden":"true"},...m},[...u.map(e=>{let[r,l]=e;return(0,t.createElement)(r,l)}),...Array.isArray(c)?c:[c]])}),i=(e,s)=>{let i=(0,t.forwardRef)((i,n)=>{let{className:d,...o}=i;return(0,t.createElement)(a,{ref:n,iconNode:s,className:l("lucide-".concat(r(e).replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()),"lucide-".concat(e),d),...o})});return i.displayName=r(e),i}},15288,e=>{"use strict";e.s(["Card",()=>l,"CardContent",()=>n,"CardDescription",()=>i,"CardHeader",()=>s,"CardTitle",()=>a]);var t=e.i(43476),r=e.i(75157);function l(e){let{className:l,...s}=e;return(0,t.jsx)("div",{"data-slot":"card",className:(0,r.cn)("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",l),...s})}function s(e){let{className:l,...s}=e;return(0,t.jsx)("div",{"data-slot":"card-header",className:(0,r.cn)("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",l),...s})}function a(e){let{className:l,...s}=e;return(0,t.jsx)("div",{"data-slot":"card-title",className:(0,r.cn)("leading-none font-semibold",l),...s})}function i(e){let{className:l,...s}=e;return(0,t.jsx)("div",{"data-slot":"card-description",className:(0,r.cn)("text-muted-foreground text-sm",l),...s})}function n(e){let{className:l,...s}=e;return(0,t.jsx)("div",{"data-slot":"card-content",className:(0,r.cn)("px-6",l),...s})}},48425,e=>{"use strict";e.s(["Primitive",()=>a,"dispatchDiscreteCustomEvent",()=>i]);var t=e.i(71645),r=e.i(74080),l=e.i(91918),s=e.i(43476),a=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"].reduce((e,r)=>{let a=(0,l.createSlot)("Primitive.".concat(r)),i=t.forwardRef((e,t)=>{let{asChild:l,...i}=e;return"undefined"!=typeof window&&(window[Symbol.for("radix-ui")]=!0),(0,s.jsx)(l?a:r,{...i,ref:t})});return i.displayName="Primitive.".concat(r),{...e,[r]:i}},{});function i(e,t){e&&r.flushSync(()=>e.dispatchEvent(t))}},93479,e=>{"use strict";e.s(["Input",()=>l]);var t=e.i(43476),r=e.i(75157);function l(e){let{className:l,type:s,...a}=e;return(0,t.jsx)("input",{type:s,"data-slot":"input",className:(0,r.cn)("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",l),...a})}},37727,e=>{"use strict";e.s(["X",()=>t],37727);let t=(0,e.i(75254).default)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},22190,80712,e=>{"use strict";e.s(["InstitutionDetailsModal",()=>x],22190);var t=e.i(43476),r=e.i(71645),l=e.i(9165),s=e.i(15288),a=e.i(87486);e.s(["ProductDetailsModal",()=>u],80712);var i=e.i(19455),n=e.i(93479),d=e.i(37727),o=e.i(67489),c=e.i(46696);function u(e){var u,m,x,p,g,h;let{isOpen:v,onClose:f,productId:b}=e,[j,y]=(0,r.useState)(!1),[N,S]=(0,r.useState)(null),[C,w]=(0,r.useState)([]),[k,I]=(0,r.useState)(null),[A,B]=(0,r.useState)(null),[D,T]=(0,r.useState)(!1),[z,M]=(0,r.useState)(!1),[E,L]=(0,r.useState)(""),[F,P]=(0,r.useState)([]),[K,V]=(0,r.useState)(!1);(0,r.useEffect)(()=>{(async()=>{if(v&&b)try{var e,t,r;y(!0);let[s,a]=await Promise.all([l.productApi.getProductById(b),l.institutionApi.getAll({page:0,size:1e3,sort:"name"})]),i=Array.isArray(a)?a:Array.isArray(null==a?void 0:a.content)?a.content:[];w(i.map(e=>({id:e.id,name:e.name}))),S(s),I(null!=(e=null==s?void 0:s.institutionId)?e:null),B(null!=(t=null==s?void 0:s.ownerId)?t:null),L(null!=(r=null==s?void 0:s.status)?r:""),O()}catch(e){console.error(e),S(null)}finally{y(!1)}})()},[v,b]);let O=async()=>{if(b)try{V(!0);let e=(await l.cyclesApi.getFiltered({userId:void 0,institutionId:void 0})).filter(e=>e.productId===b).sort((e,t)=>t.year-e.year||t.month-e.month).slice(0,6);P(e)}catch(e){console.error("Failed to load cycles:",e),P([])}finally{V(!1)}};return v&&b?(0,t.jsx)("div",{className:"fixed inset-0 bg-background/70 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:(0,t.jsxs)("div",{className:"bg-card text-foreground border rounded-lg shadow-lg max-w-xl w-full max-h-[90vh] overflow-y-auto",children:[(0,t.jsxs)("div",{className:"sticky top-0 bg-card/95 supports-[backdrop-filter]:bg-card/80 backdrop-blur border-b p-4 flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-xl font-semibold",children:"Ürün Detayları"}),(null==N?void 0:N.serial)&&(0,t.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Seri: ",N.serial]})]}),(0,t.jsx)(i.Button,{variant:"ghost",size:"sm",onClick:f,children:(0,t.jsx)(d.X,{className:"h-4 w-4"})})]}),(0,t.jsx)("div",{className:"p-4 space-y-4",children:j?(0,t.jsx)("div",{className:"text-center py-8",children:"Yüklüyor..."}):N?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(s.Card,{children:[(0,t.jsx)(s.CardHeader,{children:(0,t.jsx)(s.CardTitle,{className:"text-lg",children:"Özet"})}),(0,t.jsxs)(s.CardContent,{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[(0,t.jsxs)("div",{className:"border rounded-md p-3 bg-muted/50",children:[(0,t.jsx)("div",{className:"text-xs text-muted-foreground mb-1",children:"Marka / Model"}),(0,t.jsxs)("div",{className:"font-medium",children:[null!=(u=N.brand)?u:"-"," ",null!=(m=N.model)?m:""]})]}),(0,t.jsxs)("div",{className:"border rounded-md p-3 bg-muted/50",children:[(0,t.jsx)("div",{className:"text-xs text-muted-foreground mb-1",children:"Tip"}),(0,t.jsx)("div",{className:"font-medium",children:null!=(x=N.type)?x:"-"})]}),(0,t.jsxs)("div",{className:"border rounded-md p-3 bg-muted/50",children:[(0,t.jsx)("div",{className:"text-xs text-muted-foreground mb-1",children:"Durum"}),(0,t.jsx)("div",{className:"font-medium",children:z?(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)(n.Input,{value:E,onChange:e=>L(e.target.value),maxLength:100,placeholder:"Durum giriniz",className:"h-8"}),(0,t.jsxs)("div",{className:"text-xs text-muted-foreground text-right",children:[E.length,"/100 karakter"]})]}):(0,t.jsx)(a.Badge,{variant:"aktif"===N.status?"default":"secondary",children:N.status})})]}),(0,t.jsxs)("div",{className:"border rounded-md p-3 bg-muted/50",children:[(0,t.jsx)("div",{className:"text-xs text-muted-foreground mb-1",children:"Sorumlu"}),(0,t.jsx)("div",{className:"font-medium",children:null!=(p=N.responsibleFullName)?p:"-"})]})]})]}),(0,t.jsxs)(s.Card,{children:[(0,t.jsx)(s.CardHeader,{children:(0,t.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,t.jsx)(s.CardTitle,{className:"text-lg",children:"Kurum ve Sahip"}),!z&&(0,t.jsx)(i.Button,{size:"sm",variant:"outline",onClick:()=>M(!0),children:"Düzenle"})]})}),z?(0,t.jsxs)(s.CardContent,{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[(0,t.jsxs)("div",{className:"border rounded-md p-3 bg-muted/50",children:[(0,t.jsx)("div",{className:"text-xs text-muted-foreground mb-1",children:"Kurum"}),(0,t.jsxs)(o.Select,{value:k?String(k):void 0,onValueChange:e=>I(Number(e)),children:[(0,t.jsx)(o.SelectTrigger,{children:(0,t.jsx)(o.SelectValue,{placeholder:N.institutionName||"Kurum seçin"})}),(0,t.jsx)(o.SelectContent,{children:C.map(e=>(0,t.jsx)(o.SelectItem,{value:String(e.id),children:e.name},e.id))})]})]}),(0,t.jsxs)("div",{className:"border rounded-md p-3 bg-muted/50",children:[(0,t.jsx)("div",{className:"text-xs text-muted-foreground mb-1",children:"Sahip"}),(0,t.jsxs)(o.Select,{value:A?String(A):void 0,onValueChange:e=>B(Number(e)),children:[(0,t.jsx)(o.SelectTrigger,{children:(0,t.jsx)(o.SelectValue,{placeholder:N.ownerName||"Sahip seçin"})}),(0,t.jsx)(o.SelectContent,{children:C.map(e=>(0,t.jsx)(o.SelectItem,{value:String(e.id),children:e.name},e.id))})]})]}),(0,t.jsxs)("div",{className:"md:col-span-2 flex items-center gap-2",children:[(0,t.jsx)(i.Button,{className:"flex-1",disabled:D||!k||!A,onClick:async()=>{var e,t,r,s;if(N&&k&&A)try{T(!0),await l.productApi.updateProduct(N.id,{serial:N.serial,type:N.type,brand:N.brand,model:N.model,status:E,institutionId:k,ownerId:A,responsibleId:null!=(e=N.responsibleId)?e:void 0}),c.toast.success("Ürün güncellendi");let r=await l.productApi.getProductById(N.id);S(r),L(null!=(t=null==r?void 0:r.status)?t:""),M(!1)}catch(e){console.error(e),c.toast.error((null==e||null==(s=e.response)||null==(r=s.data)?void 0:r.message)||"Ürün güncelleme başarısız")}finally{T(!1)}},children:D?"Kaydediliyor...":"Değişiklikleri Kaydet"}),(0,t.jsx)(i.Button,{className:"flex-1",variant:"outline",onClick:()=>{var e,t,r;I(null!=(e=null==N?void 0:N.institutionId)?e:null),B(null!=(t=null==N?void 0:N.ownerId)?t:null),L(null!=(r=null==N?void 0:N.status)?r:""),M(!1)},children:"İptal"})]})]}):(0,t.jsxs)(s.CardContent,{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[(0,t.jsxs)("div",{className:"border rounded-md p-3 bg-muted/50",children:[(0,t.jsx)("div",{className:"text-xs text-muted-foreground mb-1",children:"Kurum"}),(0,t.jsx)("div",{className:"font-medium",children:null!=(g=N.institutionName)?g:"-"})]}),(0,t.jsxs)("div",{className:"border rounded-md p-3 bg-muted/50",children:[(0,t.jsx)("div",{className:"text-xs text-muted-foreground mb-1",children:"Sahip"}),(0,t.jsx)("div",{className:"font-medium",children:null!=(h=N.ownerName)?h:"-"})]})]})]}),(0,t.jsxs)(s.Card,{children:[(0,t.jsx)(s.CardHeader,{children:(0,t.jsx)(s.CardTitle,{className:"text-lg",children:"Döngü Geçmişi (Son 6 Ay)"})}),(0,t.jsx)(s.CardContent,{children:K?(0,t.jsx)("div",{className:"text-center py-4",children:"Döngüler yüklüyor..."}):0===F.length?(0,t.jsx)("p",{className:"text-muted-foreground",children:"Bu ürün için döngü verisi bulunamadı."}):(0,t.jsx)("div",{className:"space-y-2",children:F.map((e,r)=>{let l=F[r+1],s=l?e.cycleCount-l.cycleCount:null,a=null===s?"text-muted-foreground":s>=0?"text-green-600":"text-red-600";return(0,t.jsxs)("div",{className:"border rounded-md px-3 py-2 bg-muted/50",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsxs)("div",{className:"text-sm font-medium",children:[e.year,"-",String(e.month).padStart(2,"0")]}),(0,t.jsx)("div",{className:"text-sm text-muted-foreground",children:new Date(e.year,e.month-1).toLocaleString("default",{month:"long",year:"numeric"})})]}),(0,t.jsxs)("div",{className:"text-sm font-medium",children:[e.cycleCount.toLocaleString()," döngü"]})]}),null!==s&&(0,t.jsx)("div",{className:"mt-1 text-right",children:(0,t.jsxs)("span",{className:"text-xs ".concat(a),children:["Kullanım: ",s>=0?"+".concat(s.toLocaleString()):s.toLocaleString()]})})]},e.id)})})})]})]}):(0,t.jsx)("div",{className:"text-muted-foreground",children:"Ürün bulunamadı."})})]})}):null}var m=e.i(18566);function x(e){let{isOpen:n,onClose:o,institutionId:x,institutionName:p,institutionCity:g}=e,[h,v]=(0,r.useState)([]),[f,b]=(0,r.useState)([]),[j,y]=(0,r.useState)(!1),[N,S]=(0,r.useState)(!1),[C,w]=(0,r.useState)(null);(0,m.useRouter)(),(0,r.useEffect)(()=>{n&&x&&k()},[n,x]);let k=async()=>{try{y(!0),console.log("Loading data for institution ID:",x),console.log("Auth token:",localStorage.getItem("authToken"));let[e,t]=await Promise.all([l.productApi.getProductsByInstitution(x),l.institutionConsumableTypeApi.getByInstitution(x)]);console.log("Products response:",e),console.log("Types response:",t),v(e),b(t)}catch(a){var e,t,r,s;console.error("Failed to load institution data:",a),console.error("Error details:",null==a||null==(e=a.response)?void 0:e.data),console.error("Error status:",null==a||null==(t=a.response)?void 0:t.status),console.error("Error message:",null==a?void 0:a.message);let l=(null==a||null==(r=a.response)?void 0:r.status)===401?"Kimlik doğrulama gerekli. Lütfen tekrar giriş yapın.":(null==a||null==(s=a.response)?void 0:s.status)===403?"Erişim engellendi. Bu verileri görüntüleme izniniz yok.":(null==a?void 0:a.message)||"Kurum verileri yüklenemedi";c.toast.error(l)}finally{y(!1)}};return n?(0,t.jsx)("div",{className:"fixed inset-0 bg-background/70 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:(0,t.jsxs)("div",{className:"bg-card text-foreground border rounded-lg shadow-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[(0,t.jsxs)("div",{className:"sticky top-0 bg-card/95 supports-[backdrop-filter]:bg-card/80 backdrop-blur border-b p-4 flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-xl font-semibold text-foreground",children:p}),g&&(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:g})]}),(0,t.jsx)(i.Button,{variant:"ghost",size:"sm",onClick:o,children:(0,t.jsx)(d.X,{className:"h-4 w-4"})})]}),(0,t.jsx)("div",{className:"p-4 space-y-6",children:j?(0,t.jsx)("div",{className:"text-center py-8",children:"Yüklüyor..."}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(s.Card,{children:[(0,t.jsx)(s.CardHeader,{children:(0,t.jsxs)(s.CardTitle,{className:"text-lg",children:["Ürünler (",h.length,")"]})}),(0,t.jsx)(s.CardContent,{children:h.length>0?(0,t.jsx)("div",{className:"space-y-2",children:h.map(e=>(0,t.jsx)("button",{className:"w-full text-left border rounded-md p-3 bg-muted/50 hover:bg-muted transition",onClick:()=>{w(e.id),S(!0)},children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"font-medium",children:[e.brand," ",e.model," - ",e.serial]}),e.type&&(0,t.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Tip: ",e.type]}),e.responsibleFullName&&(0,t.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Sorumlu: ",e.responsibleFullName]})]}),(0,t.jsx)(a.Badge,{variant:"aktif"===e.status?"default":"secondary",children:e.status})]})},e.id))}):(0,t.jsx)("p",{className:"text-muted-foreground",children:"Bu kurum için ürün bulunamadı."})})]}),(0,t.jsxs)(s.Card,{children:[(0,t.jsx)(s.CardHeader,{children:(0,t.jsxs)(s.CardTitle,{className:"text-lg",children:["Bağlanmış Sarf Malzemesi Tipleri (",f.length,")"]})}),(0,t.jsx)(s.CardContent,{children:f.length>0?(0,t.jsx)("div",{className:"space-y-2",children:f.map(e=>(0,t.jsxs)("div",{className:"flex items-center gap-2 border rounded-md px-3 py-2 bg-muted/50",children:[(0,t.jsx)(a.Badge,{variant:"secondary",children:e.typeName}),(0,t.jsxs)("span",{className:"text-sm text-muted-foreground",children:["(",e.consumableName,")"]})]},e.id))}):(0,t.jsx)("p",{className:"text-muted-foreground",children:"Bu kuruma bağlanmış sarf malzemesi tipi yok."})})]})]})}),(0,t.jsx)(u,{isOpen:N,onClose:()=>{S(!1),w(null)},productId:C})]})}):null}},53893,e=>{"use strict";e.s(["default",()=>v],53893);var t=e.i(43476),r=e.i(71645),l=e.i(9165),s=e.i(15288),a=e.i(19455),i=e.i(67489),n=e.i(87486),d=e.i(80712),o=e.i(22190),c=e.i(93479),u=e.i(10204),m=e.i(37727),x=e.i(46696);let p=[{value:1,label:"Ocak"},{value:2,label:"Şubat"},{value:3,label:"Mart"},{value:4,label:"Nisan"},{value:5,label:"Mayıs"},{value:6,label:"Haziran"},{value:7,label:"Temmuz"},{value:8,label:"Ağustos"},{value:9,label:"Eylül"},{value:10,label:"Ekim"},{value:11,label:"Kasım"},{value:12,label:"Aralık"}];function g(e){let{isOpen:s,onClose:n,productId:d,productSerial:o,productBrand:g,productModel:h,onCycleAdded:v}=e,[f,b]=(0,r.useState)(new Date().getFullYear()),[j,y]=(0,r.useState)(new Date().getMonth()+1),[N,S]=(0,r.useState)(""),[C,w]=(0,r.useState)(!1),k=async e=>{if(e.preventDefault(),!N||isNaN(Number(N)))return void x.toast.error("Lütfen geçerli bir döngü sayısı girin");try{w(!0),await l.cycleApi.createCycle({productId:d,year:f,month:j,cycleCount:Number(N)}),x.toast.success("Döngü başarıyla eklendi"),v(),n(),S("")}catch(e){var t,r;console.error("Failed to add cycle:",e),x.toast.error((null==e||null==(r=e.response)||null==(t=r.data)?void 0:t.message)||"Döngü ekleme başarısız")}finally{w(!1)}};return s?(0,t.jsx)("div",{className:"fixed inset-0 bg-background/70 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:(0,t.jsxs)("div",{className:"bg-card text-foreground border rounded-lg shadow-lg max-w-md w-full",children:[(0,t.jsxs)("div",{className:"sticky top-0 bg-card/95 supports-[backdrop-filter]:bg-card/80 backdrop-blur border-b p-4 flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-xl font-semibold",children:"Döngü Ekle"}),(0,t.jsxs)("p",{className:"text-sm text-muted-foreground",children:[g," ",h," — ",o]})]}),(0,t.jsx)(a.Button,{variant:"ghost",size:"sm",onClick:n,children:(0,t.jsx)(m.X,{className:"h-4 w-4"})})]}),(0,t.jsxs)("form",{onSubmit:k,className:"p-4 space-y-4",children:[(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(u.Label,{htmlFor:"year",children:"Yıl"}),(0,t.jsx)(c.Input,{id:"year",type:"number",value:f,onChange:e=>b(Number(e.target.value)),min:2020,max:2030,required:!0})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(u.Label,{htmlFor:"month",children:"Ay"}),(0,t.jsxs)(i.Select,{value:String(j),onValueChange:e=>y(Number(e)),children:[(0,t.jsx)(i.SelectTrigger,{children:(0,t.jsx)(i.SelectValue,{placeholder:"Ay seçin"})}),(0,t.jsx)(i.SelectContent,{children:p.map(e=>(0,t.jsx)(i.SelectItem,{value:String(e.value),children:e.label},e.value))})]})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(u.Label,{htmlFor:"cycleCount",children:"Döngü Sayısı"}),(0,t.jsx)(c.Input,{id:"cycleCount",type:"number",value:N,onChange:e=>S(e.target.value),placeholder:"Döngü sayısını girin",min:"0",required:!0})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2 pt-4",children:[(0,t.jsx)(a.Button,{type:"submit",className:"flex-1",disabled:C||!N,children:C?"Ekleniyor...":"Döngü Ekle"}),(0,t.jsx)(a.Button,{type:"button",variant:"outline",className:"flex-1",onClick:n,children:"İptal"})]})]})]})}):null}let h=["Oca","Şub","Mar","Nis","May","Haz","Tem","Ağu","Eyl","Eki","Kas","Ara"];function v(){let e=new Date().getFullYear(),[c,u]=(0,r.useState)(e),[m,p]=(0,r.useState)(null),[v,f]=(0,r.useState)([]),[b,j]=(0,r.useState)("none"),[y,N]=(0,r.useState)(!0),[S,C]=(0,r.useState)([]),[w,k]=(0,r.useState)([]),[I,A]=(0,r.useState)({}),[B,D]=(0,r.useState)({}),[T,z]=(0,r.useState)(null),[M,E]=(0,r.useState)(!1),[L,F]=(0,r.useState)(null),[P,K]=(0,r.useState)(!1),[V,O]=(0,r.useState)(null),[R,H]=(0,r.useState)(!1),[U,Y]=(0,r.useState)(!1),X=async()=>{try{N(!0);let e=await l.productApi.getProducts(),t=Array.isArray(e)?e:[];k(t);let r=await l.institutionApi.getAll({page:0,size:200,sort:"name"}),s=Array.isArray(r)?r:Array.isArray(null==r?void 0:r.content)?r.content:[];f(s.map(e=>({id:e.id,name:e.name,city:e.city})));let a=await l.cyclesApi.getFiltered({year:c,institutionId:null!=m?m:void 0}),i=Array.isArray(a)?a:[],n="institutionName"===b?[...i].sort((e,t)=>(e.institutionName||"").localeCompare(t.institutionName||"")):"institutionCity"===b?[...i].sort((e,t)=>(e.institutionCity||"").localeCompare(t.institutionCity||"")):i;C(n);let d=Array.from(new Set(t.filter(e=>e.institutionId&&(!m||e.institutionId===m)).map(e=>e.institutionId)));if(d.length>0){let e=await l.institutionConsumablesApi.getBulkByInstitutionIds(d);A(e||{});let t={};for(let e of d)try{let r=await l.institutionConsumableTypeApi.getByInstitution(e);t[String(e)]=r}catch(r){t[String(e)]=[]}D(t)}else A({}),D({})}catch(e){console.error(e),x.toast.error("Döngüler yüklenemedi"),C([]),k([]),A({}),D({})}finally{N(!1)}};(0,r.useEffect)(()=>{X()},[c,m,b]);let W=(0,r.useMemo)(()=>{let e=new Map;for(let t of w.filter(e=>!m||e.institutionId===m)){let r="".concat(t.id,"-").concat(t.serial);e.set(r,{meta:{productId:t.id,productSerial:t.serial,productType:t.type,productBrand:t.brand,productModel:t.model,productStatus:t.status,institutionId:t.institutionId,institutionName:t.institutionName,institutionCity:t.institutionCity,ownerId:t.ownerId,ownerName:t.ownerName,responsibleId:t.responsibleId,responsibleFullName:t.responsibleFullName},months:Array(12).fill(null)})}for(let r of S){let l="".concat(r.productId,"-").concat(r.productSerial),s=e.get(l);if(s){var t;let e=Math.min(11,Math.max(0,(null!=(t=r.month)?t:1)-1));s.months[e]=r.cycleCount}}let r=Array.from(e.values());return"institutionName"===b?r.sort((e,t)=>(e.meta.institutionName||"").localeCompare(t.meta.institutionName||"")):"institutionCity"===b&&r.sort((e,t)=>(e.meta.institutionCity||"").localeCompare(t.meta.institutionCity||"")),r},[w,S,m,b]),_=async()=>{try{Y(!0);let e=await l.api.get("/api/exports/cycles",{params:{year:c},responseType:"blob"}),t=new Blob([e.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),r=window.URL.createObjectURL(t),s=document.createElement("a");s.href=r;let a=new Date,i=e=>String(e).padStart(2,"0"),n=i(a.getDate()),d=i(a.getMonth()+1),o=String(a.getFullYear()),u=i(a.getHours()),m=i(a.getMinutes());s.download="dongu-".concat(c,"-").concat(n,"-").concat(d,"-").concat(o,"-").concat(u,".").concat(m,".xlsx"),document.body.appendChild(s),s.click(),s.remove(),window.URL.revokeObjectURL(r)}catch(e){console.error(e),x.toast.error("Excel dışa aktarımı başarısız")}finally{Y(!1)}};return(0,t.jsxs)("div",{className:"max-w-6xl mx-auto py-8 space-y-4",children:[(0,t.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("h1",{className:"text-2xl font-semibold",children:"Döngüler"}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"text-sm text-muted-foreground",children:"Yıl"}),(0,t.jsxs)(i.Select,{value:String(c),onValueChange:e=>u(Number(e)),children:[(0,t.jsx)(i.SelectTrigger,{className:"w-[120px]",children:(0,t.jsx)(i.SelectValue,{placeholder:"Yıl"})}),(0,t.jsx)(i.SelectContent,{children:[e,e-1,e-2,e-3].map(e=>(0,t.jsx)(i.SelectItem,{value:String(e),children:e},e))})]}),(0,t.jsx)(a.Button,{size:"sm",variant:"outline",onClick:_,disabled:U,children:U?"İndiriliyor...":"Excel'e çıkart"})]})]}),(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"text-sm text-muted-foreground",children:"Kurum"}),(0,t.jsxs)(i.Select,{value:null===m?"all":String(m),onValueChange:e=>p("all"===e?null:Number(e)),children:[(0,t.jsx)(i.SelectTrigger,{className:"w-[260px]",children:(0,t.jsx)(i.SelectValue,{placeholder:"Tüm kurumlar"})}),(0,t.jsxs)(i.SelectContent,{children:[(0,t.jsx)(i.SelectItem,{value:"all",children:"Tümü"}),v.map(e=>(0,t.jsxs)(i.SelectItem,{value:String(e.id),children:[e.name,e.city?" — ".concat(e.city):""]},e.id))]})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"text-sm text-muted-foreground",children:"Sırala"}),(0,t.jsxs)(i.Select,{value:b,onValueChange:e=>j(e),children:[(0,t.jsx)(i.SelectTrigger,{className:"w-[220px]",children:(0,t.jsx)(i.SelectValue,{placeholder:"Sıralama yok"})}),(0,t.jsxs)(i.SelectContent,{children:[(0,t.jsx)(i.SelectItem,{value:"none",children:"Sıralama yok"}),(0,t.jsx)(i.SelectItem,{value:"institutionName",children:"Kurum adı"}),(0,t.jsx)(i.SelectItem,{value:"institutionCity",children:"Kurum şehri"})]})]})]})]})]}),y?(0,t.jsx)("p",{className:"text-muted-foreground",children:"Döngüler yüklüyor..."}):0===W.length?(0,t.jsxs)("p",{className:"text-muted-foreground",children:[c," yılı için döngü bulunamadı."]}):(0,t.jsx)("div",{className:"space-y-4",children:W.map((e,r)=>{var l,a;let{meta:i,months:d}=e;return(0,t.jsxs)(s.Card,{children:[(0,t.jsx)(s.CardHeader,{children:(0,t.jsxs)(s.CardTitle,{className:"flex flex-col gap-1 md:flex-row md:items-center md:justify-between",children:[(0,t.jsx)("button",{onClick:()=>{z({id:i.institutionId,name:i.institutionName,city:i.institutionCity}),E(!0)},className:"text-base md:text-lg font-semibold text-foreground hover:text-blue-600 hover:underline cursor-pointer text-left",children:i.institutionName}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)("button",{className:"text-sm text-muted-foreground hover:underline hover:text-blue-600",onClick:()=>{F(i.productId),K(!0)},children:[null!=(l=i.productBrand)?l:""," ",null!=(a=i.productModel)?a:""," — ",i.productSerial]}),(0,t.jsx)("button",{onClick:()=>{O({id:i.productId,serial:i.productSerial,brand:i.productBrand,model:i.productModel}),H(!0)},className:"text-xs px-2 py-1 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors",children:"+ Döngü Ekle"})]})]})}),(0,t.jsxs)(s.CardContent,{children:[(0,t.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-6 lg:grid-cols-12 gap-2",children:h.map((e,r)=>{let l=d[r],s=r>0?d[r-1]:null,a="number"==typeof l&&"number"==typeof s?l-s:null;return(0,t.jsxs)("div",{className:"border rounded p-2 text-center",children:[(0,t.jsx)("div",{className:"text-xs text-muted-foreground",children:e}),(0,t.jsx)("div",{className:"text-sm font-medium",children:null!=l?l:"-"}),(0,t.jsx)("div",{className:"text-[11px] mt-1 ".concat(null==a?"text-muted-foreground":a>0?"text-green-600":a<0?"text-red-600":"text-muted-foreground"),children:null==a?"—":a>=0?"+".concat(a):"".concat(a)})]},e)})}),(0,t.jsxs)("div",{className:"mt-3 flex flex-wrap gap-2 text-sm text-muted-foreground",children:[i.productStatus&&(0,t.jsx)(n.Badge,{variant:"secondary",children:i.productStatus}),i.responsibleFullName&&(0,t.jsxs)(n.Badge,{variant:"outline",children:["Sorumlu: ",i.responsibleFullName]}),i.productType&&(0,t.jsxs)(n.Badge,{variant:"outline",children:["Tip: ",i.productType]})]}),(0,t.jsxs)("div",{className:"mt-3 text-sm",children:[(0,t.jsx)("div",{className:"text-muted-foreground mb-1",children:"Sarf Malzemeleri"}),(0,t.jsxs)("div",{className:"flex flex-wrap gap-1",children:[(I[String(i.institutionId)]||[]).map(e=>(0,t.jsx)(n.Badge,{variant:"outline",children:e.consumableName},e.id)),!(I[String(i.institutionId)]||[]).length&&(0,t.jsx)("span",{className:"text-muted-foreground",children:"Sarf malzemesi yok"})]}),(0,t.jsx)("div",{className:"text-muted-foreground mt-2 mb-1",children:"Alt Tipler"}),(0,t.jsxs)("div",{className:"flex flex-wrap gap-1",children:[(B[String(i.institutionId)]||[]).map(e=>(0,t.jsx)(n.Badge,{variant:"secondary",children:e.typeName},e.id)),!(B[String(i.institutionId)]||[]).length&&(0,t.jsx)("span",{className:"text-muted-foreground",children:"Alt tip yok"})]})]})]})]},"".concat(i.productId,"-").concat(r))})}),T&&(0,t.jsx)(o.InstitutionDetailsModal,{isOpen:M,onClose:()=>{E(!1),z(null)},institutionId:T.id,institutionName:T.name,institutionCity:T.city}),V&&(0,t.jsx)(g,{isOpen:R,onClose:()=>{H(!1),O(null)},productId:V.id,productSerial:V.serial,productBrand:V.brand,productModel:V.model,onCycleAdded:X}),(0,t.jsx)(d.ProductDetailsModal,{isOpen:P,onClose:()=>{K(!1),F(null)},productId:L})]})}}]);