(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,87486,e=>{"use strict";e.s(["Badge",()=>n]);var t=e.i(43476),r=e.i(91918),s=e.i(25913),l=e.i(75157);let i=(0,s.cva)("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function n(e){let{className:s,variant:n,asChild:a=!1,...d}=e,o=a?r.Slot:"span";return(0,t.jsx)(o,{"data-slot":"badge",className:(0,l.cn)(i({variant:n}),s),...d})}},75254,e=>{"use strict";e.s(["default",()=>n],75254);var t=e.i(71645);let r=e=>{let t=e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,r)=>r?r.toUpperCase():t.toLowerCase());return t.charAt(0).toUpperCase()+t.slice(1)},s=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.filter((e,t,r)=>!!e&&""!==e.trim()&&r.indexOf(e)===t).join(" ").trim()};var l={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let i=(0,t.forwardRef)((e,r)=>{let{color:i="currentColor",size:n=24,strokeWidth:a=2,absoluteStrokeWidth:d,className:o="",children:c,iconNode:u,...m}=e;return(0,t.createElement)("svg",{ref:r,...l,width:n,height:n,stroke:i,strokeWidth:d?24*Number(a)/Number(n):a,className:s("lucide",o),...!c&&!(e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0})(m)&&{"aria-hidden":"true"},...m},[...u.map(e=>{let[r,s]=e;return(0,t.createElement)(r,s)}),...Array.isArray(c)?c:[c]])}),n=(e,l)=>{let n=(0,t.forwardRef)((n,a)=>{let{className:d,...o}=n;return(0,t.createElement)(i,{ref:a,iconNode:l,className:s("lucide-".concat(r(e).replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()),"lucide-".concat(e),d),...o})});return n.displayName=r(e),n}},15288,e=>{"use strict";e.s(["Card",()=>s,"CardContent",()=>a,"CardDescription",()=>n,"CardHeader",()=>l,"CardTitle",()=>i]);var t=e.i(43476),r=e.i(75157);function s(e){let{className:s,...l}=e;return(0,t.jsx)("div",{"data-slot":"card",className:(0,r.cn)("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",s),...l})}function l(e){let{className:s,...l}=e;return(0,t.jsx)("div",{"data-slot":"card-header",className:(0,r.cn)("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",s),...l})}function i(e){let{className:s,...l}=e;return(0,t.jsx)("div",{"data-slot":"card-title",className:(0,r.cn)("leading-none font-semibold",s),...l})}function n(e){let{className:s,...l}=e;return(0,t.jsx)("div",{"data-slot":"card-description",className:(0,r.cn)("text-muted-foreground text-sm",s),...l})}function a(e){let{className:s,...l}=e;return(0,t.jsx)("div",{"data-slot":"card-content",className:(0,r.cn)("px-6",s),...l})}},48425,e=>{"use strict";e.s(["Primitive",()=>i,"dispatchDiscreteCustomEvent",()=>n]);var t=e.i(71645),r=e.i(74080),s=e.i(91918),l=e.i(43476),i=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"].reduce((e,r)=>{let i=(0,s.createSlot)("Primitive.".concat(r)),n=t.forwardRef((e,t)=>{let{asChild:s,...n}=e;return"undefined"!=typeof window&&(window[Symbol.for("radix-ui")]=!0),(0,l.jsx)(s?i:r,{...n,ref:t})});return n.displayName="Primitive.".concat(r),{...e,[r]:n}},{});function n(e,t){e&&r.flushSync(()=>e.dispatchEvent(t))}},93479,e=>{"use strict";e.s(["Input",()=>s]);var t=e.i(43476),r=e.i(75157);function s(e){let{className:s,type:l,...i}=e;return(0,t.jsx)("input",{type:l,"data-slot":"input",className:(0,r.cn)("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",s),...i})}},37727,e=>{"use strict";e.s(["X",()=>t],37727);let t=(0,e.i(75254).default)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},22190,80712,e=>{"use strict";e.s(["InstitutionDetailsModal",()=>x],22190);var t=e.i(43476),r=e.i(71645),s=e.i(9165),l=e.i(15288),i=e.i(87486);e.s(["ProductDetailsModal",()=>u],80712);var n=e.i(19455),a=e.i(93479),d=e.i(37727),o=e.i(67489),c=e.i(46696);function u(e){var u,m,x,p,g,h;let{isOpen:f,onClose:v,productId:b}=e,[j,y]=(0,r.useState)(!1),[N,C]=(0,r.useState)(null),[S,w]=(0,r.useState)([]),[k,I]=(0,r.useState)(null),[A,B]=(0,r.useState)(null),[z,T]=(0,r.useState)(!1),[M,D]=(0,r.useState)(!1),[E,P]=(0,r.useState)(""),[F,K]=(0,r.useState)([]),[L,H]=(0,r.useState)(!1);(0,r.useEffect)(()=>{(async()=>{if(f&&b)try{var e,t,r;y(!0);let[l,i]=await Promise.all([s.productApi.getProductById(b),s.institutionApi.getAll({page:0,size:1e3,sort:"name"})]),n=Array.isArray(i)?i:Array.isArray(null==i?void 0:i.content)?i.content:[];w(n.map(e=>({id:e.id,name:e.name}))),C(l),I(null!=(e=null==l?void 0:l.institutionId)?e:null),B(null!=(t=null==l?void 0:l.ownerId)?t:null),P(null!=(r=null==l?void 0:l.status)?r:""),O()}catch(e){console.error(e),C(null)}finally{y(!1)}})()},[f,b]);let O=async()=>{if(b)try{H(!0);let e=(await s.cyclesApi.getFiltered({userId:void 0,institutionId:void 0})).filter(e=>e.productId===b).sort((e,t)=>t.year-e.year||t.month-e.month).slice(0,6);K(e)}catch(e){console.error("Failed to load cycles:",e),K([])}finally{H(!1)}};return f&&b?(0,t.jsx)("div",{className:"fixed inset-0 bg-background/70 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:(0,t.jsxs)("div",{className:"bg-card text-foreground border rounded-lg shadow-lg max-w-xl w-full max-h-[90vh] overflow-y-auto",children:[(0,t.jsxs)("div",{className:"sticky top-0 bg-card/95 supports-[backdrop-filter]:bg-card/80 backdrop-blur border-b p-4 flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-xl font-semibold",children:"Ürün Detayları"}),(null==N?void 0:N.serial)&&(0,t.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Seri: ",N.serial]})]}),(0,t.jsx)(n.Button,{variant:"ghost",size:"sm",onClick:v,children:(0,t.jsx)(d.X,{className:"h-4 w-4"})})]}),(0,t.jsx)("div",{className:"p-4 space-y-4",children:j?(0,t.jsx)("div",{className:"text-center py-8",children:"Yüklüyor..."}):N?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(l.Card,{children:[(0,t.jsx)(l.CardHeader,{children:(0,t.jsx)(l.CardTitle,{className:"text-lg",children:"Özet"})}),(0,t.jsxs)(l.CardContent,{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[(0,t.jsxs)("div",{className:"border rounded-md p-3 bg-muted/50",children:[(0,t.jsx)("div",{className:"text-xs text-muted-foreground mb-1",children:"Marka / Model"}),(0,t.jsxs)("div",{className:"font-medium",children:[null!=(u=N.brand)?u:"-"," ",null!=(m=N.model)?m:""]})]}),(0,t.jsxs)("div",{className:"border rounded-md p-3 bg-muted/50",children:[(0,t.jsx)("div",{className:"text-xs text-muted-foreground mb-1",children:"Tip"}),(0,t.jsx)("div",{className:"font-medium",children:null!=(x=N.type)?x:"-"})]}),(0,t.jsxs)("div",{className:"border rounded-md p-3 bg-muted/50",children:[(0,t.jsx)("div",{className:"text-xs text-muted-foreground mb-1",children:"Durum"}),(0,t.jsx)("div",{className:"font-medium",children:M?(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)(a.Input,{value:E,onChange:e=>P(e.target.value),maxLength:100,placeholder:"Durum giriniz",className:"h-8"}),(0,t.jsxs)("div",{className:"text-xs text-muted-foreground text-right",children:[E.length,"/100 karakter"]})]}):(0,t.jsx)(i.Badge,{variant:"aktif"===N.status?"default":"secondary",children:N.status})})]}),(0,t.jsxs)("div",{className:"border rounded-md p-3 bg-muted/50",children:[(0,t.jsx)("div",{className:"text-xs text-muted-foreground mb-1",children:"Sorumlu"}),(0,t.jsx)("div",{className:"font-medium",children:null!=(p=N.responsibleFullName)?p:"-"})]})]})]}),(0,t.jsxs)(l.Card,{children:[(0,t.jsx)(l.CardHeader,{children:(0,t.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,t.jsx)(l.CardTitle,{className:"text-lg",children:"Kurum ve Sahip"}),!M&&(0,t.jsx)(n.Button,{size:"sm",variant:"outline",onClick:()=>D(!0),children:"Düzenle"})]})}),M?(0,t.jsxs)(l.CardContent,{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[(0,t.jsxs)("div",{className:"border rounded-md p-3 bg-muted/50",children:[(0,t.jsx)("div",{className:"text-xs text-muted-foreground mb-1",children:"Kurum"}),(0,t.jsxs)(o.Select,{value:k?String(k):void 0,onValueChange:e=>I(Number(e)),children:[(0,t.jsx)(o.SelectTrigger,{children:(0,t.jsx)(o.SelectValue,{placeholder:N.institutionName||"Kurum seçin"})}),(0,t.jsx)(o.SelectContent,{children:S.map(e=>(0,t.jsx)(o.SelectItem,{value:String(e.id),children:e.name},e.id))})]})]}),(0,t.jsxs)("div",{className:"border rounded-md p-3 bg-muted/50",children:[(0,t.jsx)("div",{className:"text-xs text-muted-foreground mb-1",children:"Sahip"}),(0,t.jsxs)(o.Select,{value:A?String(A):void 0,onValueChange:e=>B(Number(e)),children:[(0,t.jsx)(o.SelectTrigger,{children:(0,t.jsx)(o.SelectValue,{placeholder:N.ownerName||"Sahip seçin"})}),(0,t.jsx)(o.SelectContent,{children:S.map(e=>(0,t.jsx)(o.SelectItem,{value:String(e.id),children:e.name},e.id))})]})]}),(0,t.jsxs)("div",{className:"md:col-span-2 flex items-center gap-2",children:[(0,t.jsx)(n.Button,{className:"flex-1",disabled:z||!k||!A,onClick:async()=>{var e,t,r,l;if(N&&k&&A)try{T(!0),await s.productApi.updateProduct(N.id,{serial:N.serial,type:N.type,brand:N.brand,model:N.model,status:E,institutionId:k,ownerId:A,responsibleId:null!=(e=N.responsibleId)?e:void 0}),c.toast.success("Ürün güncellendi");let r=await s.productApi.getProductById(N.id);C(r),P(null!=(t=null==r?void 0:r.status)?t:""),D(!1)}catch(e){console.error(e),c.toast.error((null==e||null==(l=e.response)||null==(r=l.data)?void 0:r.message)||"Ürün güncelleme başarısız")}finally{T(!1)}},children:z?"Kaydediliyor...":"Değişiklikleri Kaydet"}),(0,t.jsx)(n.Button,{className:"flex-1",variant:"outline",onClick:()=>{var e,t,r;I(null!=(e=null==N?void 0:N.institutionId)?e:null),B(null!=(t=null==N?void 0:N.ownerId)?t:null),P(null!=(r=null==N?void 0:N.status)?r:""),D(!1)},children:"İptal"})]})]}):(0,t.jsxs)(l.CardContent,{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[(0,t.jsxs)("div",{className:"border rounded-md p-3 bg-muted/50",children:[(0,t.jsx)("div",{className:"text-xs text-muted-foreground mb-1",children:"Kurum"}),(0,t.jsx)("div",{className:"font-medium",children:null!=(g=N.institutionName)?g:"-"})]}),(0,t.jsxs)("div",{className:"border rounded-md p-3 bg-muted/50",children:[(0,t.jsx)("div",{className:"text-xs text-muted-foreground mb-1",children:"Sahip"}),(0,t.jsx)("div",{className:"font-medium",children:null!=(h=N.ownerName)?h:"-"})]})]})]}),(0,t.jsxs)(l.Card,{children:[(0,t.jsx)(l.CardHeader,{children:(0,t.jsx)(l.CardTitle,{className:"text-lg",children:"Döngü Geçmişi (Son 6 Ay)"})}),(0,t.jsx)(l.CardContent,{children:L?(0,t.jsx)("div",{className:"text-center py-4",children:"Döngüler yüklüyor..."}):0===F.length?(0,t.jsx)("p",{className:"text-muted-foreground",children:"Bu ürün için döngü verisi bulunamadı."}):(0,t.jsx)("div",{className:"space-y-2",children:F.map((e,r)=>{let s=F[r+1],l=s?e.cycleCount-s.cycleCount:null,i=null===l?"text-muted-foreground":l>=0?"text-green-600":"text-red-600";return(0,t.jsxs)("div",{className:"border rounded-md px-3 py-2 bg-muted/50",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsxs)("div",{className:"text-sm font-medium",children:[e.year,"-",String(e.month).padStart(2,"0")]}),(0,t.jsx)("div",{className:"text-sm text-muted-foreground",children:new Date(e.year,e.month-1).toLocaleString("default",{month:"long",year:"numeric"})})]}),(0,t.jsxs)("div",{className:"text-sm font-medium",children:[e.cycleCount.toLocaleString()," döngü"]})]}),null!==l&&(0,t.jsx)("div",{className:"mt-1 text-right",children:(0,t.jsxs)("span",{className:"text-xs ".concat(i),children:["Kullanım: ",l>=0?"+".concat(l.toLocaleString()):l.toLocaleString()]})})]},e.id)})})})]})]}):(0,t.jsx)("div",{className:"text-muted-foreground",children:"Ürün bulunamadı."})})]})}):null}var m=e.i(18566);function x(e){let{isOpen:a,onClose:o,institutionId:x,institutionName:p,institutionCity:g}=e,[h,f]=(0,r.useState)([]),[v,b]=(0,r.useState)([]),[j,y]=(0,r.useState)(!1),[N,C]=(0,r.useState)(!1),[S,w]=(0,r.useState)(null);(0,m.useRouter)(),(0,r.useEffect)(()=>{a&&x&&k()},[a,x]);let k=async()=>{try{y(!0),console.log("Loading data for institution ID:",x),console.log("Auth token:",localStorage.getItem("authToken"));let[e,t]=await Promise.all([s.productApi.getProductsByInstitution(x),s.institutionConsumableTypeApi.getByInstitution(x)]);console.log("Products response:",e),console.log("Types response:",t),f(e),b(t)}catch(i){var e,t,r,l;console.error("Failed to load institution data:",i),console.error("Error details:",null==i||null==(e=i.response)?void 0:e.data),console.error("Error status:",null==i||null==(t=i.response)?void 0:t.status),console.error("Error message:",null==i?void 0:i.message);let s=(null==i||null==(r=i.response)?void 0:r.status)===401?"Kimlik doğrulama gerekli. Lütfen tekrar giriş yapın.":(null==i||null==(l=i.response)?void 0:l.status)===403?"Erişim engellendi. Bu verileri görüntüleme izniniz yok.":(null==i?void 0:i.message)||"Kurum verileri yüklenemedi";c.toast.error(s)}finally{y(!1)}};return a?(0,t.jsx)("div",{className:"fixed inset-0 bg-background/70 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:(0,t.jsxs)("div",{className:"bg-card text-foreground border rounded-lg shadow-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[(0,t.jsxs)("div",{className:"sticky top-0 bg-card/95 supports-[backdrop-filter]:bg-card/80 backdrop-blur border-b p-4 flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-xl font-semibold text-foreground",children:p}),g&&(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:g})]}),(0,t.jsx)(n.Button,{variant:"ghost",size:"sm",onClick:o,children:(0,t.jsx)(d.X,{className:"h-4 w-4"})})]}),(0,t.jsx)("div",{className:"p-4 space-y-6",children:j?(0,t.jsx)("div",{className:"text-center py-8",children:"Yüklüyor..."}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(l.Card,{children:[(0,t.jsx)(l.CardHeader,{children:(0,t.jsxs)(l.CardTitle,{className:"text-lg",children:["Ürünler (",h.length,")"]})}),(0,t.jsx)(l.CardContent,{children:h.length>0?(0,t.jsx)("div",{className:"space-y-2",children:h.map(e=>(0,t.jsx)("button",{className:"w-full text-left border rounded-md p-3 bg-muted/50 hover:bg-muted transition",onClick:()=>{w(e.id),C(!0)},children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"font-medium",children:[e.brand," ",e.model," - ",e.serial]}),e.type&&(0,t.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Tip: ",e.type]}),e.responsibleFullName&&(0,t.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Sorumlu: ",e.responsibleFullName]})]}),(0,t.jsx)(i.Badge,{variant:"aktif"===e.status?"default":"secondary",children:e.status})]})},e.id))}):(0,t.jsx)("p",{className:"text-muted-foreground",children:"Bu kurum için ürün bulunamadı."})})]}),(0,t.jsxs)(l.Card,{children:[(0,t.jsx)(l.CardHeader,{children:(0,t.jsxs)(l.CardTitle,{className:"text-lg",children:["Bağlanmış Sarf Malzemesi Tipleri (",v.length,")"]})}),(0,t.jsx)(l.CardContent,{children:v.length>0?(0,t.jsx)("div",{className:"space-y-2",children:v.map(e=>(0,t.jsxs)("div",{className:"flex items-center gap-2 border rounded-md px-3 py-2 bg-muted/50",children:[(0,t.jsx)(i.Badge,{variant:"secondary",children:e.typeName}),(0,t.jsxs)("span",{className:"text-sm text-muted-foreground",children:["(",e.consumableName,")"]})]},e.id))}):(0,t.jsx)("p",{className:"text-muted-foreground",children:"Bu kuruma bağlanmış sarf malzemesi tipi yok."})})]})]})}),(0,t.jsx)(u,{isOpen:N,onClose:()=>{C(!1),w(null)},productId:S})]})}):null}},15076,e=>{"use strict";e.s(["default",()=>x]);var t=e.i(43476),r=e.i(71645),s=e.i(9165),l=e.i(15288),i=e.i(67489),n=e.i(87486),a=e.i(19455),d=e.i(93479),o=e.i(80712),c=e.i(22190),u=e.i(46696);let m=["Oca","Şub","Mar","Nis","May","Haz","Tem","Ağu","Eyl","Eki","Kas","Ara"];function x(){let e=new Date().getFullYear(),[x,p]=(0,r.useState)(e),[g,h]=(0,r.useState)(!0),[f,v]=(0,r.useState)([]),[b,j]=(0,r.useState)([]),[y,N]=(0,r.useState)(new Map),[C,S]=(0,r.useState)(null),[w,k]=(0,r.useState)(!1),[I,A]=(0,r.useState)(null),[B,z]=(0,r.useState)(!1),[T,M]=(0,r.useState)(null),[D,E]=(0,r.useState)({}),[P,F]=(0,r.useState)(!1),K=async()=>{try{h(!0);let e=await s.userAssignmentsApi.getMyAssignedProducts(),t=Array.isArray(e)?e:[];j(t);let r=await s.userAssignmentsApi.getUserAssignments(),l=Array.isArray(r)?r:[];v(l);let i=new Map;for(let e of t)try{let t=await s.productApi.getProductById(e.productId);t&&i.set(e.productId,t)}catch(t){console.error("Failed to load product ".concat(e.productId,":"),t)}N(i)}catch(e){console.error(e),u.toast.error("Ürünleriniz yüklenemedi")}finally{h(!1)}};(0,r.useEffect)(()=>{K()},[]);let L=()=>{M(null),E({})},H=async(e,t)=>{try{F(!0);let r=f.filter(t=>t.productId===e&&t.year===x);for(let l=0;l<12;l++){let i=D["".concat(e,"-").concat(l)],n=t[l];if(i===((null==n?void 0:n.toString())||""))continue;let a=l+1;if(i&&""!==i.trim()&&!isNaN(Number(i))){let t=Number(i),l=r.find(e=>e.month===a);l?await s.cycleApi.updateCycle(l.id,{productId:e,year:x,month:a,cycleCount:t}):await s.cycleApi.createCycle({productId:e,year:x,month:a,cycleCount:t})}}await K(),M(null),E({}),u.toast.success("Döngü verileri kaydedildi")}catch(e){console.error("Error saving cycles:",e),u.toast.error("Döngü verileri kaydedilemedi")}finally{F(!1)}},O=(0,r.useMemo)(()=>{let e=new Map;for(let t of b){let r=y.get(t.productId);if(!r)continue;let s="".concat(t.productId,"-").concat(t.productSerial);e.set(s,{meta:{productId:t.productId,productSerial:t.productSerial,productType:r.type,productBrand:r.brand,productModel:r.model,productStatus:r.status,institutionId:r.institutionId,institutionName:r.institutionName,institutionCity:r.institutionCity,ownerId:r.ownerId,ownerName:r.ownerName,responsibleId:r.responsibleId,responsibleFullName:r.responsibleFullName},months:Array(12).fill(null)})}for(let r of f.filter(e=>e.year===x)){let s="".concat(r.productId,"-").concat(r.productSerial),l=e.get(s);if(l){var t;let e=Math.min(11,Math.max(0,(null!=(t=r.month)?t:1)-1));l.months[e]=r.cycleCount}}return Array.from(e.values())},[b,y,f,x]);return(0,t.jsxs)("div",{className:"max-w-6xl mx-auto py-8 space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("h1",{className:"text-2xl font-semibold",children:"Ürünlerim"}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"text-sm text-muted-foreground",children:"Yıl"}),(0,t.jsxs)(i.Select,{value:String(x),onValueChange:e=>p(Number(e)),children:[(0,t.jsx)(i.SelectTrigger,{className:"w-[120px]",children:(0,t.jsx)(i.SelectValue,{placeholder:"Yıl"})}),(0,t.jsx)(i.SelectContent,{children:Array.from({length:5},(t,r)=>e-2+r).map(e=>(0,t.jsx)(i.SelectItem,{value:String(e),children:e},e))})]})]})]}),g?(0,t.jsx)("p",{className:"text-muted-foreground",children:"Ürünleriniz yüklüyor..."}):0===O.length?(0,t.jsxs)("p",{className:"text-muted-foreground",children:[x," yılı için size atanmış ürün bulunamadı."]}):(0,t.jsx)("div",{className:"space-y-4",children:O.map((e,r)=>{var s,i;let{meta:o,months:c}=e;return(0,t.jsxs)(l.Card,{children:[(0,t.jsx)(l.CardHeader,{children:(0,t.jsxs)(l.CardTitle,{className:"flex flex-col gap-1 md:flex-row md:items-center md:justify-between",children:[(0,t.jsxs)("button",{onClick:()=>{A({id:o.institutionId,name:o.institutionName,city:o.institutionCity}),z(!0)},className:"text-base md:text-lg font-semibold text-foreground hover:text-blue-600 hover:underline cursor-pointer text-left",children:[o.institutionName," (",o.institutionCity,")"]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)("button",{onClick:()=>{S(o.productId),k(!0)},className:"text-sm text-muted-foreground hover:underline hover:text-blue-600",children:[null!=(s=o.productBrand)?s:""," ",null!=(i=o.productModel)?i:""," — ",o.productSerial]}),T===o.productId?(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)(a.Button,{size:"sm",onClick:()=>H(o.productId,c),disabled:P,className:"text-xs px-2 py-1",children:P?"Kaydediliyor...":"Kaydet"}),(0,t.jsx)(a.Button,{size:"sm",variant:"outline",onClick:L,disabled:P,className:"text-xs px-2 py-1",children:"İptal"})]}):(0,t.jsx)(a.Button,{size:"sm",variant:"outline",onClick:()=>((e,t)=>{M(e);let r={};t.forEach((t,s)=>{r["".concat(e,"-").concat(s)]=null!==t?t.toString():""}),console.log("Initializing edit values:",r),E(r)})(o.productId,c),className:"text-xs px-2 py-1",children:"Düzenle"})]})]})}),(0,t.jsxs)(l.CardContent,{children:[(0,t.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-6 lg:grid-cols-12 gap-2",children:m.map((e,r)=>{let s=c[r],l=r>0?c[r-1]:null,i="number"==typeof s&&"number"==typeof l?s-l:null,n="".concat(o.productId,"-").concat(r),a=T===o.productId;return(0,t.jsxs)("div",{className:"border rounded p-2 text-center",children:[(0,t.jsx)("div",{className:"text-xs text-muted-foreground",children:e}),a?(0,t.jsx)(d.Input,{type:"number",value:D[n]||"",onChange:e=>{var t;return t=e.target.value,void E(e=>({...e,[n]:t}))},className:"text-sm text-center border-0 bg-transparent p-0 h-auto focus:ring-0 focus:outline-none",placeholder:"0",min:"0",style:{fontSize:"14px",lineHeight:"1.25rem",fontWeight:"500",appearance:"textfield",MozAppearance:"textfield",WebkitAppearance:"none"},onWheel:e=>e.target.blur(),onFocus:t=>{console.log("Month ".concat(e," (").concat(r,") - Current value:"),s,"Input value:",D[n])}}):(0,t.jsx)("div",{className:"text-sm font-medium",children:null!=s?s:"-"}),!a&&(0,t.jsx)("div",{className:"text-[11px] mt-1 ".concat(null==i?"text-muted-foreground":i>=0?"text-green-600":"text-red-600"),children:null==i?"—":i>=0?"+".concat(i):"".concat(i)})]},e)})}),(0,t.jsxs)("div",{className:"mt-3 flex flex-wrap gap-2 text-sm text-muted-foreground",children:[o.productStatus&&(0,t.jsx)(n.Badge,{variant:"secondary",children:o.productStatus}),o.responsibleFullName&&(0,t.jsxs)(n.Badge,{variant:"outline",children:["Sorumlu: ",o.responsibleFullName]}),o.productType&&(0,t.jsxs)(n.Badge,{variant:"outline",children:["Tip: ",o.productType]})]})]})]},"".concat(o.productId,"-").concat(r))})}),I&&(0,t.jsx)(c.InstitutionDetailsModal,{isOpen:B,onClose:()=>{z(!1),A(null)},institutionId:I.id,institutionName:I.name,institutionCity:I.city}),(0,t.jsx)(o.ProductDetailsModal,{isOpen:w,onClose:()=>{k(!1),S(null)},productId:C})]})}}]);